<script src="/js/otp.js" defer></script>
<link rel="stylesheet" href="/css/otp.css">
<%- include('./layouts/userHeader') %>

  <body>
    <div class="container">
      <header>
        <i class="bx bxs-check-shield"></i>
      </header>
      <h4>OTP Verification</h4>
      <h6>Enter 4-Digit Verification Code (OTP) <br /> Please check your email for the verification code</h6>
      <form action="/otp" method="post" id="otpForm">
        <div class="input-field">
          <input type="hidden" name="email" value="<%= email %>" />
          <input type="number" name="digit1" required />
          <input type="number" name="digit2" required disabled />
          <input type="number" name="digit3" required disabled />
          <input type="number" name="digit4" required disabled />
        </div>
        <% if (messages.length> 0) { %>
          <div style="color: red;">
            <%= messages[0] %>
          </div>
          <% } %>
            <span class="text-info-emphasis" id="timer"></span> <!-- Timer display -->
            <a href="javascript:void(0);" onclick="resendOTP()" id="resendLink"
              style="display: none; margin-top: 3px; text-decoration: none;">Resend OTP</a>
            <!-- Resend link initially hidden -->

            <button type="submit" style=" margin: 3px 0px 10px;">Verify OTP</button>

      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"></script>

    <script>
      let timer;
      let countdown = 30; // seconds

      function startTimer() {
        timer = setInterval(function () {
          document.getElementById("timer").innerHTML = `Resend OTP in ${countdown} seconds`;
          if (countdown <= 0) {
            document.getElementById("resendLink").style.display = "inline"; // Show resend link
            document.getElementById("timer").innerHTML = "";
            clearInterval(timer);
          }
          countdown--;
        }, 1000);
      }

      function resendOTP() {
        // Reset countdown and start the timer again
        countdown = 30;
        document.getElementById("resendLink").style.display = "none"; // Hide resend link
        startTimer();

        // Logic to resend OTP goes here
        fetch("/resentOtp", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ email: "<%= email %>" }),
        })
          .then(response => response.json())
          .then(data => {
            console.log(data);
            if (data.success) {
              alert(data.message);
            } else {
              alert(`Error: ${data.message}`);
            }
          })

      }

      // Start the timer when the page loads
      document.addEventListener("DOMContentLoaded", function () {
        startTimer();
      });
    </script>



    <%- include('./layouts/footer') %>