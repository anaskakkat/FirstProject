<style>
    .disabled {
        pointer-events: none;
        opacity: 0.5;
        /* Add any other styles as needed */
    }
</style>

<%- include('./layouts/header') %>

    <!--banner-->
    <div class="banner-top">
        <div class="container">
            <h1>Single</h1>
            <em></em>
            <h2><a href="/">Home</a><label>/</label>Single</h2>
        </div>
    </div>
    <div class="single">

        <div class="container">

            <div class="col-md-9">
                <div class="col-md-5 grid">
                    <div class="flexslider">

                        <% if (messages.length> 0) { %>
                            <div style="color: red;">
                                <%= messages[0] %>
                            </div>
                            <% } %>
                                <ul class="slides">
                                    <% singleproducts.images.forEach(images=> { %>
                                        <li data-thumb="/<%= images %>">
                                            <div class="thumb-image"> <img src="/<%= images %>" data-imagezoom="true"
                                                    class="img-responsive"> </div>
                                        </li>
                                        <% }) %>
                                </ul>
                    </div>
                </div>
                <div class="col-md-7 single-top-in">
                    <div class="span_2_of_a1 simpleCart_shelfItem">
                        <h3>
                            <%= singleproducts.productName %>
                        </h3>
                        <p class="in-para"> There are many variations available. </p>
                        <div class="price_single">
                            <span class="reducedfrom item_price">Rs-<%= singleproducts.price %></span>
                            <!-- <a href="#">click for offer</a> -->
                            <div class="clearfix"></div>
                        </div>
                        <h4 class="quick">Quick Overview:</h4>
                        <p class="quick_desc">Rs-<%= singleproducts.description %>
                        </p>
                        <div class="wish-list">
                            <ul>
                                <li class="wish"><a href="#"><span class="glyphicon glyphicon-check"
                                            aria-hidden="true"></span>Add to Wishlist</a></li>
                                <li class="compare text-muted"> Stock:<span id="stock" class="glyphicon fw-5">
                                        <%= singleproducts.stock %>
                                    </span></li>
                            </ul>





                        </div>
                        <div class="quantity">
                            <p class="m-5"></p>
                            <div class="quantity-select">
                                <div class="entry value-minus">&nbsp;</div>
                                <div class="entry value" id="quantity"><span>1</span></div>
                                <div class="entry value-plus active">&nbsp;</div>

                            </div>
                        </div>
                        <!--quantity-->
                        <script>
                            $('.value-plus').on('click', function () {
                                let stock = $('#stock').text();
                                stock = parseInt(stock)
                                var divUpd = $(this).parent().find('.value'), newVal = parseInt(divUpd.text(), 10) + 1;
                                if (newVal <= stock) {
                                    divUpd.text(newVal);
                                    updateCartQuantity(newVal);

                                }
                            });
                            $('.value-minus').on('click', function () {
                                let stock = $('#stock').text();
                                stock = parseInt(stock)
                                var divUpd = $(this).parent().find('.value'), newVal = parseInt(divUpd.text(), 10) - 1;
                                if (newVal >= 1) {
                                    divUpd.text(newVal);
                                    updateCartQuantity(newVal);
                                }
                            });



                        </script>
                        <!--quantity-->
                        <form action="/addToCart/<%= singleproducts._id %>" method="post">
                            <input type="hidden" name="cartQuantity" id="cartQuantity" value="1">
                            <button type="submit" class="add-to btn hvr-skew-backward">Add to cart</button>
                        </form>
                        <!-- <a href="#" class="add-to item_add hvr-skew-backward">Add to cart</a> -->
                        <div class="clearfix"> </div>
                    </div>

                </div>
                <!-- <script>
                    function updateCartQuantity(value) {
                        console.log('cartqty', value)
                        $('#cartQuantity').val(value)
                        $('productQty').val(value)
                    }
                </script> -->
                <div class="clearfix"> </div>
                <!---->
                <div class="tab-head">
                    <nav class="nav-sidebar">
                        <ul class="nav tabs">
                            <li class="active"><a href="#tab1" data-toggle="tab">Product Description</a></li>
                            <li class=""><a href="#tab2" data-toggle="tab">Additional Information</a></li>
                            <li class=""><a href="#tab3" data-toggle="tab">Reviews</a></li>
                        </ul>
                    </nav>
                    <div class="tab-content one">
                        <div class="tab-pane active text-style" id="tab1">
                            <div class="facts">
                                <p> There are many variations of passages of Lorem Ipsum available, but the majority
                                    have suffered alteration in some form, by injected humour, or randomised words which
                                    don't look even slightly believable. If you are going to use a passage of Lorem
                                    Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of
                                    text. All the Lorem Ipsum generators on the Internet tend to repeat predefined
                                    chunks as necessary, making this the first true generator on the Internet. It uses a
                                    dictionary of over 200 Latin words, combined </p>
                                <ul>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Research</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Design and
                                        Development</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Porting and
                                        Optimization</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>System
                                        integration</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Verification,
                                        Validation and Testing</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Maintenance and
                                        Support</li>
                                </ul>
                            </div>

                        </div>
                        <div class="tab-pane text-style" id="tab2">

                            <div class="facts">
                                <p> Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a
                                    piece of classical Latin literature from 45 BC, making it over 2000 years old.
                                    Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked
                                    up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and
                                    going through the cites of the word in classical literature, discovered the
                                    undoubtable source. Lorem Ipsum comes from sections </p>
                                <ul>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Multimedia
                                        Systems</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Digital media
                                        adapters</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Set top boxes for
                                        HDTV and IPTV Player </li>
                                </ul>
                            </div>

                        </div>
                        <div class="tab-pane text-style" id="tab3">

                            <div class="facts">
                                <p> There are many variations of passages of Lorem Ipsum available, but the majority
                                    have suffered alteration in some form, by injected humour, or randomised words which
                                    don't look even slightly believable. If you are going to use a passage of Lorem
                                    Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of
                                    text. All the Lorem Ipsum generators on the Internet tend to repeat predefined
                                    chunks as necessary, making this the first true generator on the Internet. It uses a
                                    dictionary of over 200 Latin words, combined </p>
                                <ul>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Research</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Design and
                                        Development</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Porting and
                                        Optimization</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>System
                                        integration</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Verification,
                                        Validation and Testing</li>
                                    <li><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Maintenance and
                                        Support</li>
                                </ul>
                            </div>

                        </div>

                    </div>
                    <div class="clearfix"></div>
                </div>
                <!---->
            </div>



            <%- include('./layouts/footer') %>


                <script>
                    // Add SweetAlert to show product added to cart
                    $('form').submit(function (e) {
                        e.preventDefault();

                        // Check if the user is logged in
                        // If logged in, make an AJAX request or submit the form data as needed
                        var stock = parseInt($('#stock').text(), 10);
                        if (stock > 0) {
                            $.ajax({
                                type: 'POST',
                                url: $(this).attr('action'),
                                data: $(this).serialize(),
                                success: function (response) {
                                    if (response.success) {
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Product added to cart!',
                                            showConfirmButton: false,
                                            timer: 1500
                                        });
                                    } else {
                                        // Different SweetAlert message for not logged in user
                                        if (response.message === "User not logged in.") {
                                            Swal.fire({
                                                icon: 'info',
                                                title: 'Please log in to add items to your cart.',
                                                showConfirmButton: true
                                            });
                                        } else {
                                            // Default SweetAlert message for other errors
                                            Swal.fire({
                                                icon: 'warning',
                                                title: 'No Stock Available. , Stock Qty Already In Cart.',
                                                showConfirmButton: true
                                            });
                                        }
                                    }
                                },
                                error: function (error) {
                                    console.error('Error adding product to cart:', error);
                                    // Default SweetAlert message for other errors
                                    Swal.fire({
                                        icon: 'info',
                                        title: 'An error occurred while adding the product to your cart.',
                                        showConfirmButton: true
                                    });
                                }
                            });
                        } else {
                            // Display SweetAlert if stock is zero
                            Swal.fire({
                                icon: 'warning',
                                title: 'Product out of stock!',
                                showConfirmButton: true
                            });
                        }
                    });

                    // Update the cart quantity and check if plus button should be disabled
                    function updateCartQuantity(value) {
                        var stock = parseInt($('#stock').text(), 10);
                        var quantity = parseInt(value, 10);
                        $('#cartQuantity').val(quantity);

                        // Update quantity display
                        $('#quantity span').text(quantity);

                        // Disable plus button if quantity equals stock
                        $('.value-plus').toggleClass('disabled', quantity >= stock);
                    }
                </script>