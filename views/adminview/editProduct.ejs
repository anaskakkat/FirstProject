<%- include('./layouts/adminHeader') %>

    <section class="content-main">
        <div class="row">
            <div class="col-lg-9">
                <div class="content-header">
                    <h2 class="content-title">Edit Product</h2>

                </div>

            </div>

        </div>

        <form action="/admin/editProducts/" method="post" enctype="multipart/form-data" class="row">
            <div class="col-lg-6 data-table">
                <!-- Basic Info Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Basic</h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label for="productName" class="form-label">Product title</label>
                            <input type="text" placeholder="Product name" class="form-control" id="productName"
                                name="productName" required value="<%= products.productName%>" />
                        </div>
                        <div class="mb-4">
                            <label class="form-label" for="productDesc">Full description</label>
                            <textarea placeholder="Type here" class="form-control" rows="4" id="productDesc"
                                name="productDesc" required><%= products.description%> </textarea>
                        </div>
                        <div class="row ">
                            <div class="col-lg-4">
                                <div class="mb-4">
                                    <label class="form-label" for="productPrice">Price</label>
                                    <div class="row gx-2">
                                        <input placeholder="â‚¹" type="number" class="form-control" id="productPrice"
                                            name="productPrice" min="0" required value="<%= products.price%>" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4">
                                    <label class="form-label" for="productQty">Quantity</label>
                                    <input placeholder="Qty" type="number" class="form-control" id="productQty"
                                        name="productQty" min="0" required value="<%= products.qty%>" />
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="mb-4">
                                    <label class="form-label" for="productCat">Category</label>
                                    <select class="form-select" name="productCat" id="productCat" required
                                        value="<%= products.category%>">
                                        <option>
                                            <%= products.category%>
                                        </option>

                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4">
                                    <label class="form-label" for="brand">Brand</label>
                                    <input placeholder="Brand" type="text" class="form-control" id="brand" name="brand"
                                        required value="<%= products.brand%>" />
                                </div>
                            </div>
                        </div>
                        <div class="card mb-4">
                            <div class="card-body">
                                <!-- <div>
                                    <label class="form-label"></label>
                                    <input class="form-control" id="image-input" type="file" multiple
                                        name="productImages" required />
                                </div> -->
                            </div>
                        </div>
                        <div class="card-body">
                            <button type="submit" id="submitForm" class="btn btn-md rounded font-sm hover-up">Save
                                Product</button>
                        </div>
                    </div>
                </div>

                <!-- Save Product Button -->

            </div>

            <!-- Image Preview Container -->
            <div class="col-lg-6">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h4>Image Preview</h4>
                                <div class="row">
                                    <!-- Display existing images -->
                                    <% products.images.forEach((img, index)=> { %>
                                        <div class="col-lg-6 image-container mt-5" data-index="<%= index %>">
                                            <img src="/<%= img %>" alt="">
                                            <a href="#" class="remove-image-btn mb-2 text-danger"
                                                onclick="removeImage('<%= img %>', '<%= index %>', '<%= products._id %>')">Remove
                                                Image</a>
                                        </div>
                                        <% }) %>

                                            <!-- Container for adding new images -->
                                            <!-- Inside your HTML file -->
                                            <div class="col-lg-6 add-image-container">
                                                <input type="file" id="imageInput" accept="image/*">
                                                <a href="#" id="addImageButton" >Add Image</a>
                                            </div>




                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- Crop Images Button -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card-body">
                            <!-- <button type="button" id="crop-button" class="btn btn-md rounded font-sm hover-up" disabled>Crop Images</button> -->
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </section>

    <!-- Include the admin footer -->
    <%- include('./layouts/adminFooter') %>


        <script>
            function removeImage(imgPath, index, productId) {
                // Send an AJAX request to delete the image

                fetch(`/admin/deleteImage/${productId}/${index}`, {
                    method: 'POST',
                })
                    .then(response => response.json())
                    .then(data => {
                        // Update the UI after successful deletion
                        if (data.success) {
                            const imageContainer = document.querySelector(`.image-container[data-index="${index}"]`);
                            if (imageContainer) {
                                imageContainer.remove();
                            }
                        } else {
                            console.error(data.error);
                            alert('Failed to delete image. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.');
                    });
            }
            // Assuming you are using JavaScript for frontend logic
            document.addEventListener('DOMContentLoaded', function () {
                // Add event listener for the "Add Image" button
                document.getElementById('addImageButton').addEventListener('click', function () {
                    // Get the input element
                    const imageInput = document.getElementById('imageInput');

                    // Get the selected file
                    const file = imageInput.files[0];

                    // Check if a file is selected
                    if (file) {
                        // Create a FormData object to send the file to the server
                        const formData = new FormData();
                        formData.append('image', file);

                        // Make a fetch request to the server to handle the image upload
                        fetch('/admin/addImage', {
                            method: 'POST',
                            body: formData,
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    console.log('Image added successfully');
                                    // Perform any additional actions on the client side
                                } else {
                                    console.error('Error adding image:', data.error);
                                    // Handle the error on the client side
                                }
                            })
                            .catch(error => {
                                console.error('Network error or other issue:', error);
                                // Handle the error on the client side
                            });
                    } else {
                        console.warn('No file selected');
                    }
                });
            });

        </script>